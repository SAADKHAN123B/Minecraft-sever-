<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Minecraft Server Panel</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: sans-serif; }
    body { background-color: #f4f4f4; }
    #login { width: 100%; height: 100vh; display: flex; align-items: center; justify-content: center; }
    .login-box {
      background: white; padding: 30px; border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .login-box input, .login-box button {
      width: 100%; padding: 10px; margin-top: 10px; border-radius: 4px;
    }
    .login-box input { border: 1px solid #ccc; }
    .login-box button {
      background: #4caf50; color: white; border: none; cursor: pointer;
    }
    #loginError { color: red; text-align: center; }

    #panel { display: none; height: 100vh; }
    .sidebar {
      width: 200px; background-color: #2d2d2d; color: white; padding-top: 20px;
    }
    .sidebar div {
      padding: 15px 20px; cursor: pointer;
    }
    .sidebar div:hover { background-color: #444; }

    .content {
      flex-grow: 1; padding: 30px; background: #fff; overflow-y: auto; width: 100%;
    }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    button.control-btn {
      margin: 5px; padding: 10px 20px; border: none;
      background: #4caf50; color: white; border-radius: 4px; cursor: pointer;
    }

    input[type="file"] {
      margin-top: 10px;
    }

    .upload-section {
      margin-top: 10px;
    }
  </style>
</head>
<body>

<!-- LOGIN PAGE -->
<div id="login">
  <div class="login-box">
    <h2 style="text-align:center;">Login Panel</h2>
    <input type="text" id="username" placeholder="Username">
    <input type="password" id="password" placeholder="Password">
    <button onclick="checkLogin()">Login</button>
    <p id="loginError"></p>
  </div>
</div>

<!-- PANEL PAGE -->
<div id="panel">
  <div class="sidebar">
    <div onclick="showTab('control')">Control</div>
    <div onclick="showTab('software')">Software</div>
    <div onclick="showTab('plugin')">Plugin</div>
    <div onclick="showTab('world')">World</div>
    <div onclick="showTab('player')">Player</div>
  </div>
  <div class="content">
    <div id="control" class="tab-content">
      <h2>Server Control</h2>
      <button class="control-btn" onclick="startServer()">Start</button>
      <button class="control-btn" onclick="stopServer()">Stop</button>
      <button class="control-btn" onclick="restartServer()">Restart</button>
      <p id="serverStatus">Status: OFF</p>
    </div>
    <div id="software" class="tab-content">
      <h2>Software</h2>
      <p>Click below to download PaperMC:</p>
      <button class="control-btn" onclick="window.open('https://papermc.io/downloads', '_blank')">Download PaperMC</button>
    </div>
    <div id="plugin" class="tab-content">
      <h2>Plugins</h2>
      <div class="upload-section">
        <input type="file" id="pluginUpload" accept=".jar">
        <button class="control-btn" onclick="uploadPlugin()">Upload Plugin</button>
        <p id="pluginMsg"></p>
        <ul id="pluginList"></ul>
      </div>
    </div>
    <div id="world" class="tab-content">
      <h2>World</h2>
      <div id="worldUploadSection">
        <input type="file" id="worldUpload" webkitdirectory directory>
        <button class="control-btn" onclick="uploadWorld()">Upload World</button>
        <p id="worldMsg"></p>
      </div>
    </div>
    <div id="player" class="tab-content">
      <h2>Players</h2>
      <div>
        <label>Enter username for OP:</label>
        <input type="text" id="opUsername">
        <button class="control-btn" onclick="addOp()">Add OP</button>
        <ul id="opList"></ul>
      </div>
      <div>
        <h3>Banned Players</h3>
        <ul id="bannedList"></ul>
      </div>
    </div>
  </div>
</div>

<script>
  function checkLogin() {
    const user = document.getElementById('username').value;
    const pass = document.getElementById('password').value;
    if (user === 'Sarkar' && pass === 'Sarkar') {
      document.getElementById('login').style.display = 'none';
      document.getElementById('panel').style.display = 'flex';
      showTab('control');
      loadPlugins(); // Load plugins on login
    } else {
      document.getElementById('loginError').innerText = "Invalid username or password.";
    }
  }

  function showTab(tabId) {
    const tabs = document.querySelectorAll('.tab-content');
    tabs.forEach(tab => tab.classList.remove('active'));
    document.getElementById(tabId).classList.add('active');
  }

  function startServer() {
    fetch('/start').then(() => {
      document.getElementById('serverStatus').innerText = "Status: ON";
    });
  }

  function stopServer() {
    fetch('/stop').then(() => {
      document.getElementById('serverStatus').innerText = "Status: OFF";
    });
  }

  function restartServer() {
    fetch('/restart').then(() => {
      document.getElementById('serverStatus').innerText = "Status: RESTARTING...";
      setTimeout(() => {
        document.getElementById('serverStatus').innerText = "Status: ON";
      }, 3000);
    });
  }

  function uploadPlugin() {
    const fileInput = document.getElementById('pluginUpload');
    const file = fileInput.files[0];
    if (!file || !file.name.endsWith('.jar')) {
      document.getElementById('pluginMsg').innerText = "Please select a plugin .jar file.";
      return;
    }

    const formData = new FormData();
    formData.append('plugin', file);

    fetch('/upload-plugin', {
      method: 'POST',
      body: formData
    })
    .then(res => res.text())
    .then(msg => {
      document.getElementById('pluginMsg').innerText = msg;
      fileInput.value = '';
      loadPlugins();
    });
  }

  function loadPlugins() {
    fetch('/plugins')
      .then(res => res.json())
      .then(plugins => {
        const list = document.getElementById('pluginList');
        list.innerHTML = '';
        plugins.forEach(p => {
          const li = document.createElement('li');
          li.innerText = p;
          list.appendChild(li);
        });
      });
  }

  function uploadWorld() {
    const input = document.getElementById('worldUpload');
    const files = input.files;
    if (!files.length) {
      document.getElementById('worldMsg').innerText = "Please select a world folder.";
      return;
    }

    const formData = new FormData();
    for (const file of files) {
      formData.append('world', file, file.webkitRelativePath);
    }

    fetch('/upload-world', {
      method: 'POST',
      body: formData
    })
    .then(res => res.text())
    .then(msg => {
      document.getElementById('worldMsg').innerText = msg;
    });
  }

  function addOp() {
    const username = document.getElementById('opUsername').value;
    if (!username) return;

    fetch('/add-op', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ username })
    })
    .then(() => {
      const list = document.getElementById('opList');
      const li = document.createElement('li');
      li.innerText = username;
      list.appendChild(li);
    });
  }
</script>

</body>
</html>
